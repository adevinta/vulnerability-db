/*
Add new field to finding_exposures table
to store time at which an EXPIRED finding
is actually expired.
*/
ALTER TABLE finding_exposures 
ADD COLUMN expired_at TIMESTAMP WITHOUT TIME ZONE;

/*
Update currently expired findings to set the
new expired_at field to its found_at field value + 60 days
*/
UPDATE finding_exposures
SET expired_at = found_at + interval '60 days'
WHERE fixed_at IS NULL AND finding_id IN (
    SELECT f.id FROM findings f
    WHERE f.status = 'EXPIRED'
);
