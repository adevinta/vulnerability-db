/*
Copyright 2021 Adevinta
*/

package store

import (
	"reflect"
	"testing"
)

func TestSortSourceFamilies(t *testing.T) {
	tests := []struct {
		name           string
		sourceFamilies SourceFamilies
		sortedFamilies SourceFamilies
	}{
		{
			name: "Single family",
			sourceFamilies: SourceFamilies{
				SourceFamily{
					Name:      "Name",
					Component: "Component",
					Target:    "Target",
				},
			},
			sortedFamilies: SourceFamilies{
				SourceFamily{
					Name:      "Name",
					Component: "Component",
					Target:    "Target",
				},
			},
		},
		{
			name: "Two unordered families",
			sourceFamilies: SourceFamilies{
				SourceFamily{
					Name:      "Name",
					Component: "Component",
					Target:    "Target",
				},
				SourceFamily{
					Name:      "AFamily",
					Component: "Component",
					Target:    "Target",
				},
			},
			sortedFamilies: SourceFamilies{
				SourceFamily{
					Name:      "AFamily",
					Component: "Component",
					Target:    "Target",
				},
				SourceFamily{
					Name:      "Name",
					Component: "Component",
					Target:    "Target",
				},
			},
		},
		{
			name: "Three unordered mixed families",
			sourceFamilies: SourceFamilies{
				SourceFamily{
					Name:      "Name",
					Component: "Component2",
					Target:    "Target",
				},
				SourceFamily{
					Name:      "AFamily",
					Component: "Component",
					Target:    "Target",
				},
				SourceFamily{
					Name:      "Name",
					Component: "Component",
					Target:    "Target",
				},
			},
			sortedFamilies: SourceFamilies{
				SourceFamily{
					Name:      "AFamily",
					Component: "Component",
					Target:    "Target",
				},
				SourceFamily{
					Name:      "Name",
					Component: "Component",
					Target:    "Target",
				},
				SourceFamily{
					Name:      "Name",
					Component: "Component2",
					Target:    "Target",
				},
			},
		},
	}

	for _, tc := range tests {
		t.Run(tc.name, func(t *testing.T) {
			tc.sourceFamilies.Sort()
			if !reflect.DeepEqual(tc.sourceFamilies, tc.sortedFamilies) {
				t.Fatalf("Error sorting source families. Expected\n%v\nBut got:\n%v",
					tc.sourceFamilies, tc.sortedFamilies)
			}
		})
	}
}
