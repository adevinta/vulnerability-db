#!/bin/bash

send_sqs_message() {
    local -r target=$1
    local -r check_id="$2"
    local -r checktype_name="$3"
    local -r report_file="$4"

    AWS_ACCESS_KEY_ID=fake AWS_SECRET_ACCESS_KEY=fake aws sns publish --region local --endpoint-url http://localhost:4100 --topic-arn arn:aws:sns:local:012345678900:VulcanLocalhostChecks --message '
            {
                "target":"'"${target}"'",
                "status":"FINISHED",
                "id":"'"${check_id}"'",
                "tag":"team:test",
                "checktype_name":"'"${checktype_name}"'",
                "report":"http://localhost:8080/'"${report_file}"'"
            }' --message-attributes '{"status":{"DataType":"String","StringValue":"FINISHED"}}'
}

old_model_happy_path() {
    read -r -p "Press enter to start"
    send_sqs_message "api.example.com" "old-model-happy-path-01" "vulcan-old-model-happy-path-check" "old-model-happy-path-01.json"
    read -r -p "Press enter to continue"
    send_sqs_message "api.example.com" "old-model-happy-path-02" "vulcan-old-model-happy-path-check" "old-model-happy-path-02.json"
    read -r -p "Press enter to continue"
    send_sqs_message "api.example.com" "old-model-happy-path-03" "vulcan-old-model-happy-path-check" "old-model-happy-path-03.json"
}

old_model_fix_repoen_fix() {
    read -r -p "Press enter to start"
    send_sqs_message "api.example.com" "old-model-fix-repoen-fix-01" "vulcan-old-model-fix-repoen-fix-check" "old-model-fix-repoen-fix-01.json"
    read -r -p "Press enter to continue"
    send_sqs_message "api.example.com" "old-model-fix-repoen-fix-02" "vulcan-old-model-fix-repoen-fix-check" "old-model-fix-repoen-fix-02.json"
    read -r -p "Press enter to continue"
    send_sqs_message "api.example.com" "old-model-fix-repoen-fix-03" "vulcan-old-model-fix-repoen-fix-check" "old-model-fix-repoen-fix-03.json"
    read -r -p "Press enter to continue"
    send_sqs_message "api.example.com" "old-model-fix-repoen-fix-04" "vulcan-old-model-fix-repoen-fix-check" "old-model-fix-repoen-fix-04.json"
}

old_model_to_new_model() {
    read -r -p "Press enter to start"
    send_sqs_message "api.example.com" "old-model-to-new-model-01" "vulcan-old-model-to-new-model-check" "old-model-to-new-model-01.json"
    read -r -p "Press enter to continue"
    send_sqs_message "api.example.com" "old-model-to-new-model-02" "vulcan-old-model-to-new-model-check" "old-model-to-new-model-02.json"
    read -r -p "Press enter to continue"
    send_sqs_message "api.example.com" "old-model-to-new-model-03" "vulcan-old-model-to-new-model-check" "old-model-to-new-model-03.json"
}

mixed_old_and_new_model() {
    read -r -p "Press enter to start"
    send_sqs_message "api.example.com" "mixed-old-and-new-model-01" "vulcan-mixed-old-and-new-model-check" "mixed-old-and-new-model-01.json"
    send_sqs_message "test.example.com" "mixed-old-and-new-model-02" "vulcan-mixed-old-and-new-model-check" "mixed-old-and-new-model-02.json"
    read -r -p "Press enter to continue"
    send_sqs_message "api.example.com" "mixed-old-and-new-model-03" "vulcan-mixed-old-and-new-model-check" "mixed-old-and-new-model-03.json"
    send_sqs_message "test.example.com" "mixed-old-and-new-model-04" "vulcan-mixed-old-and-new-model-check" "mixed-old-and-new-model-04.json"
    read -r -p "Press enter to continue"
    send_sqs_message "api.example.com" "mixed-old-and-new-model-05" "vulcan-mixed-old-and-new-model-check" "mixed-old-and-new-model-05.json"
    send_sqs_message "test.example.com" "mixed-old-and-new-model-06" "vulcan-mixed-old-and-new-model-check" "mixed-old-and-new-model-06.json"
}

cat << EOF
Available test scenarios:
  1) old-model-happy-path
  2) old-model-fix-repoen-fix
  3) old-model-to-new-model
  4) mixed-old-and-new-model

Select test scenario: 
EOF

read -r SCENARIO

case "$SCENARIO" in

  1)
    old_model_happy_path
    ;;

  2)
    old_model_fix_repoen_fix
    ;;

  3)
    old_model_to_new_model
    ;;

  4)
    mixed_old_and_new_model
    ;;

  *)
    echo "Unknown test scenario [${SCENARIO}] selected."
    exit 1
    ;;
esac

echo "Test [${SCENARIO}] completed."
