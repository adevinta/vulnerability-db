#!/bin/bash

docker-compose up -d 

sleep 5

./start.sh & 

AWS_ACCESS_KEY_ID=fake AWS_SECRET_ACCESS_KEY=fake aws sns publish --region local --endpoint-url http://localhost:4100 --topic-arn arn:aws:sns:local:012345678900:VulcanLocalhostChecks --message \
        '{
            "status":"FINISHED",
            "id":"old-model-happy-path-01",
            "tag":"team:test",
            "target":"api.example.com",
            "checktype_name":"vulcan-http-headers",
            "report":"http://localhost:8080/old-model-happy-path-01.json"
        }' --message-attributes '{"status":{"DataType":"String","StringValue":"FINISHED"}}'

echo "Local Deployment Exit Code: " $?
